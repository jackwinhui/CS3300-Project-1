<html>

<head>
	<script src="https://d3js.org/d3.v7.min.js"></script>
	<style>
		.gridlines line {
			stroke: #fff;
		}

		.gridlines .domain {
			stroke: none;
		}

		.small {
			font: bold 30px garamond;
		}

		svg {
			background-size: 1200px 800px;
			background: linear-gradient( rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5) ),url('./marvel_logo.jpg');
		}
	</style>
</head>
<svg height=800 width=1200 style="border:1px solid black">
</svg>
<script>
	const svg = d3.select("svg");
	const width = svg.attr("width");
	const height = svg.attr("height");
	const margin = { top: 100, right: 100, bottom: 100, left: 100 };
	const chartWidth = width - margin.left - margin.right;
	const chartHeight = height - margin.top - margin.bottom;
	let annotations = svg.append("g").attr("id", "annotations");
	let chartArea = svg.append("g").attr("id", "points")
		.attr("transform", `translate(${margin.left},${margin.top})`);

	d3.csv("./mcu_box_office.csv", d3.autoType).then(
		(data) => {
			console.log(data)
			const timeParser = d3.timeParse('%m/%d/%Y'); //m/d/yyyy
			data.forEach(d => { d['worldwide_box_office'] = Number(parseFloat(d['worldwide_box_office'].replace(/,/g, ''))); });
			data.forEach(d => { d['production_budget'] = Number(parseFloat(d['production_budget'].replace(/,/g, ''))); });
			data.forEach(d => { d['release_date'] = timeParser(d['release_date']); });

			//x-axis with Date
			const dateExtent = d3.extent(data, d => d['release_date']);
			const dateScale = d3.scaleTime()
				.domain(dateExtent)
				.range([0, chartWidth]);
			let bottomAxis = d3.axisBottom(dateScale);
			annotations.append("g")
				.attr("class", "x axis")
				.attr("transform", `translate(${margin.left},${chartHeight + margin.top + 10})`)
				.style("color","white")
				.call(bottomAxis);

			//y-axis with boxOffice - productionBudget
			const boxOfficeExtent = d3.extent(data, d => (d['worldwide_box_office'] - d['production_budget']) / 1000000);
			const boxOfficeScale = d3.scaleLinear().domain(boxOfficeExtent).range([chartHeight, 0]);
			let leftAxis = d3.axisLeft(boxOfficeScale);
			annotations.append("g")
				.attr("class", "y axis")
				.attr("transform", `translate(${margin.left - 10},${margin.top})`)
				.style("color","white")
				.call(leftAxis);

			//y-axis gridlines
			let leftGridlines = d3.axisLeft(boxOfficeScale).tickSize(-chartWidth - 10).tickFormat("");
			svg.append('g')
				.attr("class", "y gridlines")
				.attr("transform", `translate(${margin.left - 10}, ${margin.top})`)
				.call(leftGridlines);

			//x-axis gridlines
			let bottomGridlines = d3.axisBottom(dateScale).tickSize(-chartHeight - 10).tickFormat("");
			svg.append('g')
				.attr("class", "x gridlines")
				.attr("transform", `translate(${margin.left}, ${chartHeight + margin.top + 10})`)
				.call(bottomGridlines);

			annotations.append("text")
				.attr("class", "small")
				.attr("text-anchor", "middle")
				.attr("x", margin.left + chartWidth / 2)
				.attr("y", margin.top - 20)
				.text("MARVEL PROFIT PER YEAR");
			annotations.append("text")
				.attr("class", "small")
				.attr("text-anchor", "middle")
				.attr("x", margin.left + chartWidth / 2)
				.attr("y", margin.top + chartHeight + 70)
				.text("Date, (Year)");

			// annotations.append("text")
			//    .attr("class", "small")
			//    .attr("text-anchor", "middle")
			//    .attr("y", 40)
			//    .attr("x", chartHeight/2)
			//    .attr("transform", "rotate(-90)")
			//    .text("Profit");
			// annotations.append("text")
			//    .attr("class", "extrasmall")
			//    .attr("text-anchor", "middle")
			//    .attr("y", chartHeight/2)
			//    .attr("x", 60)
			//    .attr("transform", "rotate(-90)")
			//    .text("(worldwide box office revenue - production budget)");

			// svg.append('svg:image')
			//	.attr('xlink:href', "./marvel_logo.jpeg")
			// .attr("width", 115.5)
			// .attr("height", 100)
			// .attr("x", 0)
			// .attr("y", 0);
		})
</script>

</html>